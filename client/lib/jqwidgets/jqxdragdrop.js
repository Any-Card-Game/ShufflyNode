/*
jQWidgets v2.2.0 (2012-May-25)
Copyright (c) 2011-2012 jQWidgets.
License: http://jqwidgets.com/license/
*/

(function(a){a.jqx.jqxWidget("jqxDragDrop","",{});a.extend(a.jqx._jqxDragDrop.prototype,{defineInstance:function(){this.restricter="document";this.handle=false;this.feedback="clone";this.opacity=0.6;this.revert=false;this.revertDuration=400;this.distance=5;this.disabled=false;this.tolerance="intersect";this.data=null;this.dropAction="default";this.dragZIndex=99999;this.appendTo="parent";this.cursor="move";this.onDragEnd=null;this.onDrag=null;this.onDragStart=null;this.onTargetDrop=null;this.onDropTargetEnter=null;this.onDropTargetLeave=null;this.initFeedback=null;this._touchEvents={mousedown:"touchstart",click:"touchstart",mouseup:"touchend",mousemove:"touchmove",mouseenter:"mouseenter",mouseleave:"mouseleave"};this._restricter=null;this._zIndexBackup=0;this._targetEnterFired=false;this._oldOpacity=1;this._feedbackType;this._isTouchDevice=false;this._events=["dragStart","dragEnd","dragging","dropTargetEnter","dropTargetLeave"]},createInstance:function(){this._createDragDrop()},_createDragDrop:function(){var c=a.data(document.body,"jqx-draggables")||1;this.appendTo=this._getParent();this._isTouchDevice=a.jqx.mobile.isTouchDevice();if((/(static|relative)/).test(this.host.css("position"))){if(!this.feedback||this.feedback==="original"){var d=this._getRelativeOffset(this.host);var b=this.appendTo.offset();if(this.appendTo.css("position")!="static"){b={left:0,top:0}}this.element.style.position="absolute";this.element.style.left=b.left+d.left+"px";this.element.style.top=b.top+d.top+"px"}}this._validateProperties();this._idHandler(c);if(this.disabled){this.disable()}if(typeof this.dropTarget==="string"){this.dropTarget=a(this.dropTarget)}this._refresh();c+=1;a.data(document.body,"jqx-draggables",c);this.host.addClass("jqx-draggable");this.host.css("cursor",this.cursor)},_getParent:function(){var b=this.appendTo;if(typeof this.appendTo==="string"){switch(this.appendTo){case"parent":b=this.host.parent();break;case"document":b=a(document);break;case"body":b=a(document.body);break;default:b=a(this.appendTo);break}}return b},_idHandler:function(b){if(!this.element.id){var c="jqx-draggable-"+b;this.element.id=c}},_refresh:function(){this._removeEventHandlers();this._addEventHandlers()},_getEvent:function(b){if(this._isTouchDevice){return this._touchEvents[b]}else{return b}},_validateProperties:function(){if(this.feedback==="clone"){this._feedbackType="clone"}else{this._feedbackType="original"}if(this.dropAction!=="default"){this.dropAction="nothing"}},_removeEventHandlers:function(){this.removeHandler(this.host,"dragstart");this.removeHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown);this.removeHandler(a(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove);this.removeHandler(a(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp)},_addEventHandlers:function(){var b=this;this.addHandler(this.host,"dragstart",function(d){d.preventDefault();return false});this.addHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown,{self:this});this.addHandler(a(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove,{self:this});this.addHandler(a(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp,{self:this});if(window.frameElement){if(window.top!=null){var c=function(d){b._mouseUp(b)};if(window.top.document.addEventListener){window.top.document.addEventListener("mouseup",c,false)}else{if(window.top.document.attachEvent){window.top.document.attachEvent("onmouseup",c)}}}}},_mouseDown:function(e){var b=e.data.self,d=b._getMouseCoordinates(e),c=b._mouseCapture(e);b._originalPageX=d.left;b._originalPageY=d.top;if(!b._mouseStarted){b._mouseUp(e)}if(c){b._mouseDownEvent=e}if(e.which!==1||!c){return true}e.preventDefault()},_mouseMove:function(c){var b=c.data.self;if(b._mouseStarted){b._mouseDrag(c);return c.preventDefault()}if(b._mouseDownEvent&&b._isMovedDistance(c)){if(b._mouseStart(b._mouseDownEvent,c)){b._mouseStarted=true}else{b._mouseStarted=false}if(b._mouseStarted){b._mouseDrag(c)}else{b._mouseUp(c)}}return !b._mouseStarted},_mouseUp:function(c){var b;if(c.data&&c.data.self){b=c.data.self}else{b=this}b._mouseDownEvent=false;b._movedDistance=false;if(b._mouseStarted){b._mouseStarted=false;b._mouseStop(c)}if(b.feedback&&b.feedback[0]&&b._feedbackType!=="original"&&typeof b.feedback.remove==="function"&&!b.revert){b.feedback.remove()}return false},cancelDrag:function(){var b=this.revertDuration;this.revertDuration=0;this._mouseDownEvent=false;this._movedDistance=false;this._mouseStarted=false;this._mouseStop();this.feedback.remove();this.revertDuration=b},_isMovedDistance:function(b){var c=this._getMouseCoordinates(b);if(this._movedDistance){return true}if(c.left>=this._originalPageX+this.distance||c.left<=this._originalPageX-this.distance||c.top>=this._originalPageY+this.distance||c.top<=this._originalPageY-this.distance){this._movedDistance=true;return true}return false},_getMouseCoordinates:function(b){if(this._isTouchDevice){return{left:b.originalEvent.touches[0].pageX,top:b.originalEvent.touches[0].pageY}}else{return{left:b.pageX,top:b.pageY}}},destroy:function(){this.host.removeData("draggable").unbind(".draggable").removeClass("jqx-draggable jqx-draggable-dragging jqx-draggable-disabled");this._removeEventHandlers();this.isDestroyed=true;return this},_disableSelection:function(b){b.each(function(){a(this).attr("unselectable","on").css({"-ms-user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return false}})})},_enableSelection:function(b){b.each(function(){a(this).attr("unselectable","off").css({"-ms-user-select":"text","-moz-user-select":"text","-webkit-user-select":"text","user-select":"text"}).each(function(){this.onselectstart=null})})},_mouseCapture:function(b){if(this.disabled){return false}if(!this._getHandle(b)){return false}this._disableSelection(this.host);return true},_getScrollParent:function(b){var c;if((a.browser.msie&&(/(static|relative)/).test(b.css("position")))||(/absolute/).test(b.css("position"))){c=b.parents().filter(function(){return(/(relative|absolute|fixed)/).test(a.curCSS(this,"position",1))&&(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}else{c=b.parents().filter(function(){return(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(b.css("position"))||!c.length?a(document):c},_mouseStart:function(d){var c=this._getMouseCoordinates(d),b=this._getParentOffset(this.host);this.feedback=this._createFeedback(d);this._zIndexBackup=this.feedback.css("z-index");this.feedback[0].style.zIndex=this.dragZIndex;this._backupFeedbackProportions();this._backupeMargins();this._positionType=this.feedback.css("position");this._scrollParent=this._getScrollParent(this.feedback);this._offset=this.positionAbs=this.host.offset();this._offset={top:this._offset.top-this.margins.top,left:this._offset.left-this.margins.left};a.extend(this._offset,{click:{left:c.left-this._offset.left,top:c.top-this._offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset(),hostRelative:this._getRelativeOffset(this.host)});this.position=this._generatePosition(d);this.originalPosition=this._fixPosition();if(this.restricter){this._setRestricter()}this.feedback.addClass(this.toThemeProperty("jqx-draggable-dragging"));this._raiseEvent(0,d);if(this.onDragStart&&typeof this.onDragStart==="function"){this.onDragStart(this.position)}this._mouseDrag(d,true);return true},_fixPosition:function(){var c=this._getRelativeOffset(this.host),b=this.position;b={left:this.position.left+c.left,top:this.position.top+c.top};return b},_mouseDrag:function(b,c){this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");this.feedback[0].style.left=this.position.left+"px";this.feedback[0].style.top=this.position.top+"px";this._raiseEvent(2,b);if(this.onDrag&&typeof this.onDrag==="function"){this.onDrag(this.data,this.position)}this._handleTarget();return false},_over:function(b,d,e){if(this.dropTarget){var f=false,c=this;a.each(this.dropTarget,function(g,h){f=c._overItem(h,b,d,e);if(f.over){return false}})}return f},_overItem:function(i,c,e,g){i=a(i);var b=i.offset(),f=i.outerHeight(),d=i.outerWidth(),h;if(!i||i[0]===this.element){return}switch(this.tolerance){case"intersect":if(c.left+e>b.left&&c.left<b.left+d&&c.top+g>b.top&&c.top<b.top+f){h=true}break;case"fit":if(e+c.left<=b.left+d&&c.left>=b.left&&g+c.top<=b.top+f&&c.top>=b.top){h=true}break}return{over:h,target:i}},_handleTarget:function(){if(this.dropTarget){var b=this.feedback.offset(),c=this.feedback.outerWidth(),d=this.feedback.outerWidth(),e=this._over(b,c,d);if(e.over){if(!this._targetEnterFired){this._targetEnterFired=true;this._raiseEvent(3,{target:e.target});if(this.onDropTargetEnter&&typeof this.onDropTargetEnter==="function"){this.onDropTargetEnter()}}}else{if(this._targetEnterFired){this._targetEnterFired=false;this._raiseEvent(4,{target:e.target});if(this.onDropTargetLeave&&typeof this.onDropTargetLeave==="function"){this.onDropTargetLeave()}}}}},_mouseStop:function(d){var e=false,b=this._fixPosition(),c={width:this.host.outerWidth(),height:this.host.outerHeight()};this.feedback[0].style.opacity=this._oldOpacity;if(!this.revert){this.feedback[0].style.zIndex=this._zIndexBackup}this._enableSelection(this.host);if(this.dropped){e=this.dropped;this.dropped=false}if((!this.element||!this.element.parentNode)&&this.feedback==="original"){return false}this._dropElement(b);this.feedback.removeClass(this.toThemeProperty("jqx-draggable-dragging"));this._raiseEvent(1,d);if(this.onDragEnd&&typeof this.onDragEnd==="function"){this.onDragEnd(this.data)}if(this.onTargetDrop&&typeof this.onTargetDrop==="function"&&this._over(b,c.width,c.height).over){this.onTargetDrop(this.data)}this._revertHandler();return false},_dropElement:function(b){if(this.dropAction==="default"&&this.feedback&&this.feedback[0]!==this.element&&this.feedback!=="original"){if(!this.revert){if(!(/(fixed|absolute)/).test(this.host.css("position"))){this.host.css("position","relative");var c=this._getRelativeOffset(this.host);b=this.position;b.left-=c.left;b.top-=c.top;this.element.style.left=b.left+"px";this.element.style.top=b.top+"px"}}}},_revertHandler:function(){if(this.revert||(a.isFunction(this.revert)&&this.revert())){var b=this;if(this._feedbackType!="original"){if(this.feedback!=null){if(this.dropAction!="none"){a(this.feedback).animate({left:b.originalPosition.left-b._offset.hostRelative.left,top:b.originalPosition.top-b._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){if(b.feedback&&b.feedback[0]&&b._feedbackType!=="original"&&typeof b.feedback.remove==="function"){b.feedback.remove()}})}else{if(b.feedback&&b.feedback[0]&&b._feedbackType!=="original"&&typeof b.feedback.remove==="function"){b.feedback.remove()}}}}else{this.element.style.zIndex=this.dragZIndex;a(this.host).animate({left:b.originalPosition.left-b._offset.hostRelative.left,top:b.originalPosition.top-b._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){b.element.style.zIndex=b._zIndexBackup})}}},_getHandle:function(b){var c;if(!this.handle){c=true}else{a(this.handle,this.host).find("*").andSelf().each(function(){if(this==b.target){c=true}})}return c},_createFeedback:function(c){var b;if(typeof this._feedbackType==="function"){b=this._feedbackType()}else{if(this._feedbackType==="clone"){b=this.host.clone().removeAttr("id")}else{b=this.host}}if(!(/(absolute|fixed)/).test(b.css("position"))){b.css("position","absolute")}if(this.appendTo[0]!==this.host.parent()[0]||b[0]!==this.element){var d={};b.css({left:this.host.offset().left-this._getParentOffset(this.host).left+this._getParentOffset(b).left,top:this.host.offset().top-this._getParentOffset(this.host).top+this._getParentOffset(b).top});b.appendTo(this.appendTo)}if(typeof this.initFeedback==="function"){this.initFeedback(b)}return b},_getParentOffset:function(c){var c=c||this.feedback;this._offsetParent=c.offsetParent();var b=this._offsetParent.offset();if(this._positionType=="absolute"&&this._scrollParent[0]!==document&&a.contains(this._scrollParent[0],this._offsetParent[0])){b.left+=this._scrollParent.scrollLeft();b.top+=this._scrollParent.scrollTop()}if((this._offsetParent[0]==document.body)||(this._offsetParent[0].tagName&&this._offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)){b={top:0,left:0}}return{top:b.top+(parseInt(this._offsetParent.css("border-top-width"),10)||0),left:b.left+(parseInt(this._offsetParent.css("border-left-width"),10)||0)}},_getRelativeOffset:function(c){var d=this._scrollParent||c.parent();c=c||this.feedback;if(c.css("position")==="relative"){var b=this.host.position();return{top:b.top-(parseInt(c.css("top"),10)||0)+d.scrollTop(),left:b.left-(parseInt(c.css("left"),10)||0)+d.scrollLeft()}}else{return{top:0,left:0}}},_backupeMargins:function(){this.margins={left:(parseInt(this.host.css("margin-left"),10)||0),top:(parseInt(this.host.css("margin-top"),10)||0),right:(parseInt(this.host.css("margin-right"),10)||0),bottom:(parseInt(this.host.css("margin-bottom"),10)||0)}},_backupFeedbackProportions:function(){this.feedback[0].style.opacity=this.opacity;this._feedbackProportions={width:this.feedback.outerWidth(),height:this.feedback.outerHeight()}},_setRestricter:function(){if(this.restricter=="parent"){this.restricter=this.feedback[0].parentNode}if(this.restricter=="document"||this.restricter=="window"){this._handleNativeRestricter()}if(typeof this.restricter.left!=="undefined"&&typeof this.restricter.top!=="undefined"&&typeof this.restricter.height!=="undefined"&&typeof this.restricter.width!=="undefined"){this._restricter=[this.restricter.left,this.restricter.top,this.restricter.width,this.restricter.height]}else{if(!(/^(document|window|parent)$/).test(this.restricter)&&this.restricter.constructor!=Array){this._handleDOMParentRestricter()}else{if(this.restricter.constructor==Array){this._restricter=this.restricter}}}},_handleNativeRestricter:function(){this._restricter=[this.restricter==="document"?0:a(window).scrollLeft()-this._offset.relative.left-this._offset.parent.left,this.restricter==="document"?0:a(window).scrollTop()-this._offset.relative.top-this._offset.parent.top,(this.restricter==="document"?0:a(window).scrollLeft())+a(this.restricter==="document"?document:window).width()-this._feedbackProportions.width-this.margins.left,(this.restricter==="document"?0:a(window).scrollTop())+(a(this.restricter==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this._feedbackProportions.height-this.margins.top]},_handleDOMParentRestricter:function(){var d=a(this.restricter),b=d[0];if(!b){return}var c=(a(b).css("overflow")!=="hidden");this._restricter=[(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0),(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0),(c?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this._feedbackProportions.width-this.margins.left-this.margins.right,(c?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this._feedbackProportions.height-this.margins.top-this.margins.bottom];this._restrictiveContainer=d},_convertPositionTo:function(f,c){if(!c){c=this.position}var e,b,g;if(f==="absolute"){e=1}else{e=-1}if(this._positionType==="absolute"&&!(this._scrollParent[0]!=document&&a.contains(this._scrollParent[0],this._offsetParent[0]))){b=this._offsetParent}else{b=this._scrollParent}g=(/(html|body)/i).test(b[0].tagName);return this._getPosition(c,e,g,b)},_getPosition:function(c,d,e,b){return{top:(c.top+this._offset.relative.top*d+this._offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this._positionType=="fixed"?0:(this._positionType=="fixed"?-this._scrollParent.scrollTop():(e?0:b.scrollTop()))*d)),left:(c.left+this._offset.relative.left*d+this._offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this._positionType=="fixed"?0:(this._positionType=="fixed"?-this._scrollParent.scrollLeft():e?0:b.scrollLeft())*d))}},_generatePosition:function(f){var b=this._positionType=="absolute"&&!(this._scrollParent[0]!=document&&a.contains(this._scrollParent[0],this._offsetParent[0]))?this._offsetParent:this._scrollParent,i=(/(html|body)/i).test(b[0].tagName);var e=this._getMouseCoordinates(f),d=e.left,c=e.top;if(this.originalPosition){var h;if(this.restricter){if(this._restrictiveContainer){var g=this._restrictiveContainer.offset();h=[this._restricter[0]+g.left,this._restricter[1]+g.top,this._restricter[2]+g.left,this._restricter[3]+g.top]}else{h=this._restricter}if(e.left-this._offset.click.left<h[0]){d=h[0]+this._offset.click.left}if(e.top-this._offset.click.top<h[1]){c=h[1]+this._offset.click.top}if(e.left-this._offset.click.left>h[2]){d=h[2]+this._offset.click.left}if(e.top-this._offset.click.top>h[3]){c=h[3]+this._offset.click.top}}}return{top:(c-this._offset.click.top-this._offset.relative.top-this._offset.parent.top+(a.browser.safari&&a.browser.version<526&&this._positionType=="fixed"?0:(this._positionType=="fixed"?-this._scrollParent.scrollTop():(i?0:b.scrollTop())))),left:(d-this._offset.click.left-this._offset.relative.left-this._offset.parent.left+(a.browser.safari&&a.browser.version<526&&this._positionType=="fixed"?0:(this._positionType=="fixed"?-this._scrollParent.scrollLeft():i?0:b.scrollLeft())))}},_raiseEvent:function(c,e){var b=this._events[c],d=a.Event(b),e=e||{};e.position=this.position;e.element=this.element;this.data=this.data;a.extend(e,this.data);d.args=e;return this.host.trigger(d)},disable:function(){this.disabled=true;this.host.addClass(this.toThemeProperty("jqx-draggable-disabled"))},enable:function(){this.disabled=false;this.host.removeClass(this.toThemeProperty("jqx-draggable-disabled"))},propertyChangedHandler:function(b,c,e,d){if(c==="dropTarget"){if(typeof d==="string"){b.dropTarget=a(d)}}else{if(c=="cursor"){b.host.css("cursor",b.cursor)}}}})})(jQuery);jqxListBoxDragDrop=function(){$.extend($.jqx._jqxListBox.prototype,{_hitTestBounds:function(a,b,d){var e=a.host.offset();var f=d-parseInt(e.top);var h=b-parseInt(e.left);var j=a._hitTest(h,f);if(a.items&&a.items.length>0){var g=a.items[a.items.length-1];if(f>g.top){j=g}}if(j!=null){var c=parseInt(e.left);var i=c+a.host.width();if(c<=b+j.width/2&&b<=i){return j}return null}return null},_handleDragStart:function(b,a){b.unbind("dragStart");b.bind("dragStart",function(f){if(a.allowDrag&&!a.disabled){a.feedbackElement=$("<div style='z-index: 99999; position: absolute;'></div>");a.feedbackElement.addClass(a.toThemeProperty("jqx-listbox-feedback"));a.feedbackElement.appendTo($(document.body));a.feedbackElement.hide();a._dragCancel=false;var d=f.args.position;var e=a._hitTestBounds(a,d.left,d.top);var g=$.find(".jqx-listbox");a._listBoxes=g;if(e!=null&&!e.isGroup){a._raiseEvent(4,{label:e.label,value:e.value,originalEvent:f.args});a._dragItem=e;if(a.dragStart){var c=a.dragStart(e);if(c==false){a._dragCancel=true;$(f.args.element).jqxDragDrop("cancelDrag");clearInterval(a._autoScrollTimer)}}}}return false})},_handleDragging:function(b,a){b.unbind("dragging");b.bind("dragging",function(e){var d=e.args;var c=d.position;if(a._dragCancel){return}a._dragOverItem=null;$.each(a._listBoxes,function(){var j=$(this).offset();var l=j.top+20;var f=$(this).height()+l-40;var h=j.left;var g=$(this).width();var m=h+g;var k=$.data(this,"jqxListBox").instance;var n=k._hitTestBounds(k,c.left,c.top);var i=k.vScrollInstance;if(n!=null){if(k.allowDrop&&!k.disabled){a._dragOverItem=n;if(n.element){a.feedbackElement.show();var o=$(n.element).offset().top+1;if(c.top>o+n.height/2){o=o+n.height}a.feedbackElement.css("top",o);a.feedbackElement.css("left",h);if(k.vScrollBar.css("visibility")!="visible"){a.feedbackElement.width($(this).width())}else{a.feedbackElement.width($(this).width()-20)}}}}if(!a._dragOverItem){a.feedbackElement.hide()}if(c.left+g>=h&&c.left<m){if(d.position.top<l){if(d.position.top<l-21){a.feedbackElement.hide()}clearInterval(k._autoScrollTimer);if(i.value!=0){a.feedbackElement.hide()}k._autoScrollTimer=setInterval(function(){var p=k.scrollUp();if(!p){clearInterval(k._autoScrollTimer)}},100)}else{if(d.position.top>f){if(d.position.top>f+15){a.feedbackElement.hide()}clearInterval(k._autoScrollTimer);if((k.vScrollBar.css("visibility")!="hidden")&&i.value!=i.max){a.feedbackElement.hide()}k._autoScrollTimer=setInterval(function(){var p=k.scrollDown();if(!p){clearInterval(k._autoScrollTimer)}},100);return false}else{clearInterval(k._autoScrollTimer)}}}else{if(a._dragOverItem==null){a.feedbackElement.hide()}clearInterval(k._autoScrollTimer)}})})},_handleDragEnd:function(b,a){var c=$.find(".jqx-listbox");b.unbind("dragEnd");b.bind("dragEnd",function(e){clearInterval(a._autoScrollTimer);var i=e.args.position;var f=$.find(".jqx-listbox");var g=null;a.feedbackElement.remove();if(a._dragCancel){return}$.each(f,function(){var t=parseInt($(this).offset().left);var r=t+$(this).width();var u=$.data(this,"jqxListBox").instance;clearInterval(u._autoScrollTimer);if(a._dragItem!=null){if(i.left+a._dragItem.width/2>=t&&i.left<r){var s=parseInt($(this).offset().top);var q=s+$(this).height();if(i.top>=s&&i.top<=q){g=$(this)}}}});var p=a._dragItem;if(g!=null&&g.length>0){var l=$.data(g[0],"jqxListBox").instance;var j=l.allowDrop;if(j&&!l.disabled){var l=$.data(g[0],"jqxListBox").instance;var m=l._hitTestBounds(l,i.left,i.top);m=a._dragOverItem;if(m!=null&&!m.isGroup){var o=true;if(a.dragEnd){o=a.dragEnd(p,m);if(o==false){$(e.args.element).jqxDragDrop("cancelDrag");clearInterval(a._autoScrollTimer)}}if(o){var d=m.index;var h=function(){var r=m.index;for(var q=r-2;q<=r+2;q++){if(l.items&&l.items.length>q){var s=l.items[q];if(s!=null){if(s.label==p.label&&s.value==p.value){return q}}}}return r};if(l.dropAction!="none"){var n=$(m.element).offset().top+1;l.content.find(".draggable").jqxDragDrop("destroy");if(i.top>n+m.height/2){l.insertAt(a._dragItem,m.index+1)}else{l.insertAt(a._dragItem,m.index)}if(a.dropAction=="default"){if(p.index>0){a.selectIndex(p.index-1)}a.removeItem(p)}var k=h();l.selectIndex(k)}}}else{if(l.dropAction!="none"){l.content.find(".draggable").jqxDragDrop("destroy");l.addItem(a._dragItem);if(l.dropAction=="default"){if(p.index>0){a.selectIndex(p.index-1)}a.removeItem(p)}l.selectIndex(0)}}}}else{if(a.dragEnd){a.dragEnd(p)}}if(p!=null){a._raiseEvent(5,{label:p.label,value:p.value,originalEvent:e.args})}return false})},_enableDragDrop:function(){if(this.allowDrag&&this.host.jqxDragDrop){var b=this.content.find(".draggable");if(b.length>0){b.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:true});this._autoScrollTimer=null;var a=this;a._dragItem=null;a._handleDragStart(b,a);a._handleDragging(b,a);a._handleDragEnd(b,a)}}}})};jqxTreeDragDrop=function(){$.extend($.jqx._jqxTree.prototype,{_syncItems:function(b){this._visibleItems=new Array();var a=this;$.each(b,function(){var d=$(this);if(d.css("display")!="none"){var c=d.outerHeight();if(d.height()>0){var e=parseInt(d.offset().top);a._visibleItems[a._visibleItems.length]={element:this,top:e,height:c,bottom:e+c}}}})},_hitTestBounds:function(a,f,e){var c=this;var d=null;if(a._visibleItems){var b=parseInt(a.host.offset().left);var g=a.host.outerWidth();$.each(a._visibleItems,function(i){if(f+$(this.element).outerWidth()>=b&&f<b+g){if(this.top+5<e&&e<this.top+this.height){var h=$(this.element).parents("li:first");if(h.length>0){d=a.getItem(h[0]);if(d!=null){d.height=this.height;d.top=this.top;return false}}}}})}return d},_handleDragStart:function(b,a){if(a._dragOverItem){a._dragOverItem.titleElement.removeClass(a.toThemeProperty("jqx-fill-state-hover"))}b.unbind("dragStart");b.bind("dragStart",function(e){a.feedbackElement=$("<div style='z-index: 99999; position: absolute;'></div>");a.feedbackElement.addClass(a.toThemeProperty("jqx-listbox-feedback"));a.feedbackElement.appendTo($(document.body));a.feedbackElement.hide();a._dragCancel=false;var c=e.args.position;var d=$.find(".jqx-tree");a._trees=d;$.each(d,function(){var h=$.data(this,"jqxTree").instance;var j=h.host.find(".draggable");h._syncItems(j);if(h.allowDrag&&!h.disabled){var g=$(e.target).parents("li:first");if(g.length>0){var i=h.getItem(g[0]);if(i){h._raiseEvent(8,{label:i.label,value:i.value,originalEvent:e.args});a._dragItem=i;if(h.dragStart){var f=h.dragStart(i);if(f==false){a._dragCancel=true;$(e.args.element).jqxDragDrop("cancelDrag");clearInterval(a._autoScrollTimer)}}}}}});return false})},_handleDragging:function(b,a){var b=this.host.find(".draggable");b.unbind("dragging");b.bind("dragging",function(f){var e=f.args;var c=e.position;var d=a._trees;if(a._dragCancel){return}$.each(d,function(){var j=$(this).offset();var n=j.top+20;var g=$(this).height()+n-40;var i=j.left;var h=$(this).width();var o=i+h;var m=$.data(this,"jqxTree").instance;if(m.disabled||!m.allowDrop){return}var k=m.vScrollInstance;var p=m._hitTestBounds(m,f.args.pageX,f.args.pageY);if(p!=null){if(a._dragOverItem){a._dragOverItem.titleElement.removeClass(m.toThemeProperty("jqx-fill-state-hover"))}a._dragOverItem=p;if(p.element){a.feedbackElement.show();var q=p.top;var l=f.args.pageY;a._dropPosition="before";if(l>q+p.height/3){q=p.top+p.height/2;a._dragOverItem.titleElement.addClass(a.toThemeProperty("jqx-fill-state-hover"));a.feedbackElement.hide();a._dropPosition="inside"}if(l>(p.top+p.height)-p.height/3){q=p.top+p.height;a._dragOverItem.titleElement.removeClass(a.toThemeProperty("jqx-fill-state-hover"));a.feedbackElement.show();a._dropPosition="after"}a.feedbackElement.css("top",q);var i=-2+parseInt(p.titleElement.offset().left);a.feedbackElement.css("left",i);a.feedbackElement.width($(p.titleElement).width()+12)}}if(f.args.pageX>=i&&f.args.pageX<o){if(f.args.pageY<n){if(e.position.top<n-21){a.feedbackElement.hide()}clearInterval(m._autoScrollTimer);if(k.value!=0){a.feedbackElement.hide()}m._autoScrollTimer=setInterval(function(){var s=m.panelInstance.scrollUp();var r=m.host.find(".draggable");m._syncItems(r);if(!s){clearInterval(m._autoScrollTimer)}},100)}else{if(f.args.pageY>g){if(e.position.top>g+15){a.feedbackElement.hide()}clearInterval(m._autoScrollTimer);if(k.value!=k.max){a.feedbackElement.hide()}m._autoScrollTimer=setInterval(function(){var s=m.panelInstance.scrollDown();var r=m.host.find(".draggable");m._syncItems(r);if(!s){clearInterval(m._autoScrollTimer)}},100);return false}else{clearInterval(m._autoScrollTimer)}}return false}else{if(a._dragOverItem){a._dragOverItem.titleElement.removeClass(a.toThemeProperty("jqx-fill-state-hover"))}clearInterval(m._autoScrollTimer)}})})},_handleDragEnd:function(b,a){b.unbind("dragEnd");b.bind("dragEnd",function(e){var c=a.host.find(".draggable");clearInterval(a._autoScrollTimer);var h=e.args.position;var o=a._trees;var p=null;a.feedbackElement.remove();if(a._dragCancel){return}if(a._dragOverItem){a._dragOverItem.titleElement.removeClass(a.toThemeProperty("jqx-fill-state-hover"))}$.each(o,function(){var u=parseInt($(this).offset().left);var s=u+$(this).width();var r=$.data(this,"jqxTree").instance;clearInterval(r._autoScrollTimer);if(a._dragItem!=null){if(e.args.pageX+$(a._dragItem.titleElement).outerWidth()/2>=u&&e.args.pageX<s){var t=parseInt($(this).offset().top);var q=t+$(this).height();if(e.args.pageY>=t&&e.args.pageY<=q){p=$(this)}}}});var n=a._dragItem;if(p!=null&&p.length>0){var i=p.jqxTree("allowDrop");if(i){var j=$.data(p[0],"jqxTree").instance;var k=a._dragOverItem;if(k!=null&&a._dragOverItem.treeInstance.element.id==j.element.id){var m=true;if(a.dragEnd){m=a.dragEnd(n,k);if(m==false){$(e.args.element).jqxDragDrop("cancelDrag");clearInterval(a._autoScrollTimer)}}if(m){var d=function(){var q=a._dragItem.treeInstance;q._refreshMapping();q._updateItemsNavigation();q._render();if(q.checkboxes){q._updateCheckStates()}a._dragItem.treeInstance=j;a._syncItems(a._dragItem.treeInstance.host.find(".draggable"))};if(j.dropAction!="none"){if(a._dragItem.id!=a._dragOverItem.id){if(a._dropPosition=="inside"){j._drop(a._dragItem.element,a._dragOverItem.element,-1,j);d()}else{var g=0;if(a._dropPosition=="after"){g++}j._drop(a._dragItem.element,a._dragOverItem.parentElement,g+$(a._dragOverItem.element).index(),j);d()}}}j._render();var l=j.host.find(".draggable");a._syncItems(l);a._dragOverItem=null;a._dragItem=null;j._refreshMapping();j._updateItemsNavigation();j.selectedItem=null;j.selectItem(n.element);if(j.checkboxes){j._updateCheckStates()}}}else{if(j.dropAction!="none"){if(j.allowDrop){a._dragItem.parentElement=null;j._drop(a._dragItem.element,null,-1,j);var f=a._dragItem.treeInstance;f._refreshMapping();f._updateItemsNavigation();if(f.checkboxes){f._updateCheckStates()}var l=f.host.find(".draggable");a._syncItems(l);a._dragItem.treeInstance=j;j.items[j.items.length]=a._dragItem;j._render();j.selectItem(n.element);j._refreshMapping();j._updateItemsNavigation();var l=j.host.find(".draggable");j._syncItems(l);if(j.checkboxes){j._updateCheckStates()}a._dragOverItem=null;a._dragItem=null}}}}}else{if(a.dragEnd){a.dragEnd(n)}}if(n!=null){a._raiseEvent(7,{label:n.label,value:n.value,originalEvent:e.args})}return false})},_drop:function(e,a,d,b){if($(a).parents("#"+e.id).length>0){return}if(a!=null){if(a.id==e.id){return}}var g=this;if(b.element.innerHTML.indexOf("UL")){var h=b.host.find("ul:first")}if(a==undefined&&a==null){if(d==undefined||d==-1){h.append(e)}else{if(h.children("li").eq(d).length==0){h.children("li").eq(d-1).after(e)}else{if(h.children("li").eq(d)[0].id!=e.id){h.children("li").eq(d).before(e)}}}}else{if(d==undefined||d==-1){a=$(a);var c=a.find("ul:first");if(c.length==0){ulElement=$("<ul></ul>");$(a).append(ulElement);c=a.find("ul:first");var f=b.itemMapping["id"+a[0].id].item;f.subtreeElement=c[0];f.hasItems=true;c.addClass(b.toThemeProperty("jqx-tree-dropdown"));c.append(e);e=c.find("li:first");f.parentElement=e}else{c.append(e)}}else{a=$(a);var c=a.find("ul:first");if(c.length==0){ulElement=$("<ul></ul>");$(a).append(ulElement);c=a.find("ul:first");if(a){var f=b.itemMapping["id"+a[0].id].item;f.subtreeElement=c[0];f.hasItems=true}c.addClass(b.toThemeProperty("jqx-tree-dropdown"));c.append(e);e=c.find("li:first");f.parentElement=e}else{if(c.children("li").eq(d).length==0){c.children("li").eq(d-1).after(e)}else{if(c.children("li").eq(d)[0].id!=e.id){c.children("li").eq(d).before(e)}}}}}},_enableDragDrop:function(){if(this.allowDrag&&this.host.jqxDragDrop){var c=this.host.find(".draggable");var b=this;if(c.length>0){c.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:true,initFeedback:function(d){var f=$('<span style="white-space: nowrap;" class="'+b.toThemeProperty("jqx-fill-state-normal")+'">'+d.text()+"</span>");$(document.body).append(f);var e=f.width();f.remove();d.width(e+5);d.addClass(b.toThemeProperty("jqx-fill-state-pressed"))}});var a=c.jqxDragDrop("isDestroyed");if(a){c.jqxDragDrop("_createDragDrop")}this._autoScrollTimer=null;b._dragItem=null;b._handleDragStart(c,b);b._handleDragging(c,b);b._handleDragEnd(c,b)}}}})};